<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>アップロードテスト</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .container { max-width: 600px; margin: 0 auto; }
        input[type="file"] { margin: 10px 0; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 20px; background: #f0f0f0; display: none; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>138DataGate - アップロードテスト</h1>
        <form id="uploadForm">
            <input type="file" id="fileInput" required><br>
            <button type="submit">アップロード</button>
        </form>
        <div id="result" class="result"></div>
    </div>
    
    <script>
    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        
        const formData = new FormData();
        const fileInput = document.getElementById("fileInput");
        formData.append("file", fileInput.files[0]);
        
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "アップロード中...";
        resultDiv.className = "result";
        resultDiv.style.display = "block";
        
        try {
            const response = await fetch("/api/upload", {
                method: "POST",
                body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
                resultDiv.className = "result success";
                resultDiv.innerHTML = `
                    <h2>✅ アップロード成功！</h2>
                    <p><strong>File ID:</strong> ${data.fileId}</p>
                    <p><strong>OTP:</strong> <span style="font-size:24px; color:#007bff;">${data.otp}</span></p>
                    <p><a href="/download.html?id=${data.fileId}" target="_blank">ダウンロードページを開く</a></p>
                `;
            } else {
                resultDiv.className = "result error";
                resultDiv.innerHTML = `<h2>❌ エラー</h2><p>${data.error}</p>`;
            }
        } catch (error) {
            resultDiv.className = "result error";
            resultDiv.innerHTML = `<h2>❌ エラー</h2><p>${error.message}</p>`;
        }
    });
    </script>
</body>
</html>
