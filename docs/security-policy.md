# 🔒 138DataGate セキュリティポリシー

**最終更新**: 2025年10月14日  
**バージョン**: 1.0  
**文書管理責任者**: 138DataGate セキュリティチーム

---

## 1. 目的

138DataGateは、PPAPに代わる安全なファイル転送ソリューションとして、お客様の重要なファイルとデータを保護することを最優先事項としています。

本ポリシーは、138DataGateが実装するセキュリティ対策、データ保護方針、および運用体制を明文化し、お客様に安心してご利用いただける環境を提供することを目的としています。

---

## 2. データ暗号化

### 2.1 ファイル暗号化

**暗号化方式**: AES-256-GCM（認証付き暗号）

- **アルゴリズム**: Advanced Encryption Standard（AES）
- **鍵長**: 256ビット
- **モード**: GCM（Galois/Counter Mode）- 認証付き暗号化
- **鍵導出**: PBKDF2（100,000反復、SHA-256）
- **適用範囲**: すべてのアップロードファイル
- **暗号化タイミング**: アップロード時に自動暗号化
- **復号条件**: 有効な認証後のみ

**特徴**:
- 銀行やクレジットカード決済と同レベルの暗号化技術
- 改ざん検知機能により、ファイルの完全性を保証
- 万が一サーバーが攻撃されても、暗号鍵がなければファイル内容は読み取れません

### 2.2 メタデータ暗号化

**対象データ**:
- ファイル名
- 送信者情報
- 受信者情報
- アップロード日時
- Phase情報

**方式**: 
- ファイル本体とは異なる暗号鍵で個別に暗号化
- 各メタデータごとに独立したIV（初期化ベクトル）を使用

**保存場所**: 
- Upstash Redis（TLS1.3暗号化通信）
- データセンター: AWS（日本リージョン）

### 2.3 暗号鍵管理

**管理方式**: Vercel環境変数（外部安全領域）

**鍵の種類**:
- **マスターキー**: 全システム共通の暗号化基礎鍵
- **派生鍵**: ファイルごとに生成される一意の暗号鍵

**セキュリティ対策**:
- マスターキーはコードに含めず、環境変数で管理
- 派生鍵はPBKDF2で100,000回反復して生成
- ソルト（Salt）とIV（初期化ベクトル）はファイルごとにランダム生成

**更新頻度**: 
- マスターキー: 年1回ローテーション
- 派生鍵: ファイルごとに新規生成

**アクセス制限**: 
- システム管理者のみ
- 多要素認証必須（今後実装予定）

---

## 3. データ保持ポリシー

### 3.1 自動削除

**保持期間**: アップロードから7日間

**削除方式**: 完全削除（復元不可）

**削除対象**:
- 暗号化されたファイル本体
- メタデータ（KVストア）
- 一時ファイル

**実行タイミング**: 毎日午前2時（UTC）に自動実行

**削除プロセス**:
1. 期限切れファイルの検出（アップロードから7日以上経過）
2. 物理ファイルの削除（storage/*.enc）
3. KVメタデータの削除
4. 削除ログの記録

### 3.2 手動削除

**実施者**: システム管理者

**実施方法**:
- 管理画面から即座に削除可能
- 削除後は復元不可

**実施ケース**:
- お客様からの削除依頼
- セキュリティインシデント発生時
- 誤アップロードの修正

---

## 4. アクセス制御

### 4.1 ダウンロード認証

**方式**: ファイルID認証

**有効期限**: 7日間（ファイル保持期間と同じ）

**再利用**: ファイルIDは一意で再利用不可

**セキュリティ特性**:
- URLを知っているだけではダウンロード不可
- ファイルIDが一致しない場合はアクセス拒否
- 期限切れファイルは自動削除されアクセス不可

### 4.2 管理者認証

**方式**: JWT（JSON Web Token）

**認証フロー**:
1. ログイン時にユーザー名とパスワードで認証
2. 成功時にJWTトークンを発行
3. 以降のAPI呼び出しでトークンを検証

**有効期限**: 24時間

**セキュリティ対策**:
- パスワードはbcryptでハッシュ化（コスト係数10）
- JWTシークレットは256ビットのランダム文字列
- トークン盗聴を防ぐため、HTTPS通信のみ

**多要素認証**: 今後実装予定

### 4.3 レート制限

**目的**: ブルートフォース攻撃やAPI乱用の防止

**適用API**:
- ログイン: 5回/15分
- テストメール送信: 3回/5分
- ファイルアップロード: 10回/分（今後実装予定）
- ファイルダウンロード: 20回/分（今後実装予定）

**実装方式**:
- KVストアを使用した分散レート制限
- IPアドレス + ルート単位で制限
- 制限超過時は429エラーを返却

---

## 5. 通信セキュリティ

### 5.1 HTTPS通信

**TLSバージョン**: 1.2以上（推奨: 1.3）

**証明書**: Let's Encrypt（自動更新）

**適用範囲**: すべての通信

**暗号スイート**:
- TLS_AES_128_GCM_SHA256
- TLS_AES_256_GCM_SHA384
- TLS_CHACHA20_POLY1305_SHA256

**セキュリティヘッダー**:
- Strict-Transport-Security（HSTS）
- X-Content-Type-Options: nosniff
- X-Frame-Options: DENY

### 5.2 APIセキュリティ

**レート制限**: 各APIに適用（DDoS対策）

**IP許可リスト**: 管理機能で設定可能（今後実装予定）

**アクセスログ**: すべてのリクエストを記録

**エラーハンドリング**:
- 詳細なエラー情報は内部ログのみ
- ユーザーには一般的なエラーメッセージのみ表示

---

## 6. 監査とログ

### 6.1 記録内容

**アクセスログ**:
- ファイルアップロード（日時、ファイルID、送信者）
- ファイルダウンロード（日時、ファイルID、IPアドレス）
- 管理者ログイン（日時、ユーザー名、IPアドレス）
- 管理者操作（日時、操作内容、対象リソース）

**セキュリティログ**:
- ログイン失敗（日時、ユーザー名、IPアドレス）
- レート制限超過（日時、API、IPアドレス）
- 認証エラー（日時、エラー内容）
- 暗号化/復号エラー（日時、ファイルID、エラー内容）

**削除ログ**:
- 自動削除実行（日時、削除件数、スキップ件数）
- 手動削除実行（日時、削除者、ファイルID）

### 6.2 ログ保持期間

**アクセスログ**: 90日間

**セキュリティログ**: 1年間

**削除ログ**: 1年間

### 6.3 ログの保護

**暗号化**: ログはすべて暗号化して保存

**アクセス制限**: システム管理者のみ閲覧可能

**改ざん防止**: ログの整合性チェック機能（今後実装予定）

---

## 7. インシデント対応

### 7.1 セキュリティインシデント発生時

**対応フロー**:

1. **検知**（即時）
   - 自動監視システムによる異常検知
   - ユーザーからの報告受付

2. **通知**（5分以内）
   - システム管理者への緊急通知
   - インシデント対応チームの招集

3. **調査**（30分以内）
   - 影響範囲の特定
   - 原因の分析
   - 対策の検討

4. **対応**（1時間以内）
   - 必要に応じてサービス一時停止
   - 該当ファイルの即時削除
   - セキュリティパッチの適用

5. **報告**（24時間以内）
   - 影響を受けたお客様への報告
   - 公式サイトでの公表（重大インシデントの場合）

### 7.2 報告内容

**お客様への報告**:
- インシデント発生日時
- 影響を受けたファイル数
- 流出の可能性の有無
- 講じた対策
- 再発防止策

**公式サイトでの公表**:
- インシデントの概要
- 影響範囲
- 対応状況
- お問い合わせ窓口

### 7.3 事後対応

**原因分析**: 詳細な原因分析レポートの作成

**再発防止**: セキュリティ対策の見直しと強化

**システム改善**: 脆弱性の修正とアップデート

**教育**: スタッフへのセキュリティ教育の実施

---

## 8. コンプライアンス

### 8.1 準拠法規

**日本国内法**:
- 個人情報保護法
- 不正アクセス禁止法
- 電子署名法
- 電子帳簿保存法

**業界標準**:
- OWASP Top 10（Webアプリケーションセキュリティ）
- NIST Cybersecurity Framework

### 8.2 第三者機関

**現状**: 自社によるセキュリティ監査

**今後の予定**:
- ISMS（情報セキュリティマネジメントシステム）認証取得を検討
- 第三者機関による定期的なセキュリティ監査の実施

---

## 9. お客様の責任

### 9.1 パスワード管理

**推奨事項**:
- 管理者パスワードの適切な管理
- 定期的なパスワード変更（推奨: 3ヶ月ごと）
- 複雑なパスワードの使用（英大小文字・数字・記号を含む12文字以上）
- パスワードの使い回し禁止

**禁止事項**:
- パスワードの第三者への共有
- 推測しやすいパスワードの使用
- パスワードのメモ書きや平文での保存

### 9.2 ダウンロードURL管理

**推奨事項**:
- ダウンロードURLは受信者のみに送信
- 不要になったファイルは即座に削除
- URLの第三者への転送禁止

**注意事項**:
- URLを知っている人は誰でもダウンロード可能
- 7日後に自動削除されるため、必要なファイルは早めにダウンロード

### 9.3 アップロードファイル

**推奨事項**:
- 機密情報は必要最小限のみアップロード
- ファイルサイズの制限内で使用（現在: 100MB）
- ウイルスチェック済みファイルのみアップロード

**禁止事項**:
- 違法なファイルのアップロード
- マルウェアやウイルスを含むファイルのアップロード
- 第三者の著作権を侵害するファイルのアップロード

---

## 10. ポリシー更新

### 10.1 更新頻度

本ポリシーは、以下の場合に更新されます：

- セキュリティ状況の変化
- サービス内容の変更
- 法規制の改正
- 新機能の追加
- セキュリティインシデントの発生

**定期見直し**: 年1回（最低）

### 10.2 変更通知

**重要な変更**:
- お客様に事前通知（30日前）
- 公式サイトでの公表
- 管理画面での通知

**軽微な変更**:
- 公式サイトでの公表のみ

### 10.3 バージョン管理

**バージョン番号**: メジャー.マイナー形式

- **メジャー更新**: 重要な変更（例: 1.0 → 2.0）
- **マイナー更新**: 軽微な変更（例: 1.0 → 1.1）

---

## 11. お問い合わせ

セキュリティに関するご質問・ご報告は、以下までご連絡ください。

### セキュリティチーム

**Email**: security@138datagate.com  
**電話**: 000-0000-0000（平日9:00-18:00）  
**緊急連絡**: emergency@138datagate.com（24時間対応）

### 脆弱性報告

セキュリティ脆弱性を発見された場合は、以下のメールアドレスまでご報告ください。

**Email**: vulnerability@138datagate.com

**報告内容**:
- 脆弱性の詳細
- 再現手順
- 影響範囲
- 連絡先

**報奨金制度**: 重大な脆弱性を報告いただいた場合、報奨金をお支払いする場合があります（詳細は別途規定）

---

## 12. 免責事項

本ポリシーは、138DataGateのセキュリティ対策を説明するものであり、すべてのセキュリティリスクを排除することを保証するものではありません。

お客様は、ご自身の責任において本サービスをご利用いただき、重要なファイルは必ずバックアップを取っていただくようお願いいたします。

---

## 付録A: 用語集

**AES-256-GCM**: Advanced Encryption Standard（高度暗号化標準）の256ビット版、GCMモード（認証付き暗号化）

**PBKDF2**: Password-Based Key Derivation Function 2（パスワードベース鍵導出関数）

**JWT**: JSON Web Token（JSON形式の認証トークン）

**TLS**: Transport Layer Security（通信暗号化プロトコル）

**KV**: Key-Value Store（キーバリューストア、高速データベース）

**ISMS**: Information Security Management System（情報セキュリティマネジメントシステム）

---

## 付録B: 変更履歴

| バージョン | 日付 | 変更内容 | 承認者 |
|-----------|------|---------|--------|
| 1.0 | 2025-10-14 | 初版発行 | セキュリティチーム |

---

**138DataGate セキュリティチーム**  
**最終更新**: 2025年10月14日  
**次回見直し予定**: 2026年10月14日
